<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decode the lyrics and meaning of a song</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .transcript p:hover {
            background-color: #f3f4f6;
            cursor: pointer;
        }
        .transcript p.highlighted {
            background-color: #e5e7eb;
        }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="container mx-auto max-w-6xl">
        <h1 class="text-4xl font-bold mb-8 text-center">Decode the lyrics and meaning of a song</h1>
        
        <!-- Input Section -->
        <div class="mb-6 flex gap-4">
            <input type="text" id="youtubeUrl" placeholder="Enter YouTube URL" 
                   class="flex-1 p-2 border rounded-md">
            <button id="fetchTranscript" 
                    class="bg-purple-600 text-white px-6 py-2 rounded-md hover:bg-purple-700">
                Get Lyrics and Meaning
            </button>
        </div>

        <!-- Content Section -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Lyrics Section -->
            <div class="bg-white rounded-lg shadow-sm border">
                <div class="bg-gray-50 p-4 border-b">
                    <h2 class="text-xl font-semibold text-gray-800">Lyrics</h2>
                </div>
                <div id="transcriptContent" class="transcript p-4">
                    Lyrics will appear here...
                </div>
            </div>

            <!-- Analysis Section -->
            <div class="bg-white rounded-lg shadow-sm border">
                <div class="bg-gray-50 p-4 border-b">
                    <h2 class="text-xl font-semibold text-gray-800">Meaning</h2>
                </div>
                <div id="analysisContent" class="p-4">
                    Click on a paragraph in the lyrics to see its meaning.
                </div>
            </div>
        </div>
    </div>

    <script>
                    // Function to extract video ID from YouTube URL
function extractVideoId(url) {
    console.log("Entering Extract Video ID Function", url);
    const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
    const match = url.match(regExp);
    return (match && match[7].length == 11) ? match[7] : false;
}

// Function to fetch transcript from our Python backend
async function fetchTranscript(videoId) {
    console.log("Entering Fetch Transcript Function", videoId);
    try {
        const response = await fetch(`http://127.0.0.1:5000/get_transcript?video_id=${videoId}`);
        const data = await response.json();
        if (!response.ok) {
            throw new Error(data.error || 'Failed to fetch lyrics from Youtube');
        }

        if (JSON.stringify(data.transcript).length > 10000)
        {
            throw new Error(data.error || 'Lyrics are too long and not supported');
        }
        
        return data.transcript;
    } catch (error) {
        console.error('Error:', error);
        alert(`Failed to fetch transcript. Error details:\n\n${error.message}`);
        return [];
    }
}

// Updated function to fetch analysis from our Python backend
async function fetchAnalysis(lyrics) {
    console.log("Entering Fetch Analysis Function", lyrics);
    try {
        const response = await fetch('http://127.0.0.1:5000/analyze_lyrics', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ lyrics: lyrics }),
        });
        const data = await response.json();
        if (!response.ok) {
            throw new Error(data.error || 'Failed to analyze lyrics');
        }
        return data.analysis;  // Assuming the server returns the parsed JSON directly
    } catch (error) {
        console.error('Error:', error);
        alert(`Failed to analyze lyrics. Error details:\n\n${error.message}`);
        return {};
    }
}

// Updated function to display transcript and set up click handlers
function displayTranscript(analysis) {
    console.log('Entering displayTranscript function', analysis);
    const transcriptContent = document.getElementById('transcriptContent');
    if (!transcriptContent) {
        console.error('Element with id "transcriptContent" not found');
        return;
    }
    transcriptContent.innerHTML = ''; // Clear existing content
    
    Object.entries(analysis).forEach(([index, paragraph]) => {
        const p = document.createElement('p');
        p.textContent = paragraph.text;
        p.addEventListener('click', () => {
            // Remove highlight from all paragraphs
            transcriptContent.querySelectorAll('p').forEach(p => p.classList.remove('highlighted'));
            // Highlight clicked paragraph
            p.classList.add('highlighted');
            // Display meaning for clicked paragraph
            displayAnalysis(paragraph.meaning);
        });
        transcriptContent.appendChild(p);
    });
}

// Function to display analysis (unchanged)
function displayAnalysis(analysis) {
    console.log('Entering displayAnalysis function',analysis);
    const analysisContent = document.getElementById('analysisContent');
    if (!analysisContent) {
        console.error('Element with id "analysisContent" not found');
        return;
    }
    analysisContent.innerHTML = `<p>${analysis}</p>`;
}

// Updated event listener for the fetch button
document.getElementById('fetchTranscript').addEventListener('click', async () => {
    console.log('Fetch button clicked');
    const urlInput = document.getElementById('youtubeUrl');
    const videoId = extractVideoId(urlInput.value);
    if (videoId) {
        const transcript = await fetchTranscript(videoId);
        
        // Join the transcript into a single string for analysis
        const lyrics = transcript.join(' ');
        const analysis = await fetchAnalysis(lyrics);

        // analysis = {
        //     "1": {
        //       "text": "♪ Ladies up in here tonight ♪\n♪ No fighting ♪\n♪ We got the refugees up in here ♪\n♪ No fighting ♪",
        //       "meaning": "This opening paragraph sets the scene, addressing the women in the audience and establishing a peaceful atmosphere with no fighting allowed. The lyrics also mention the presence of refugees, suggesting a diverse crowd."
        //     },
        //     "2": {
        //       "text": "♪ Shakira, Shakira ♪\n♪ I never really knew that\nshe could dance like this ♪\n♪ She make a man wants to speak Spanish ♪\n♪ Como se llama, si ♪\n♪ Bonita, si ♪\n♪ Mi casa ♪",
        //       "meaning": "This paragraph focuses on Shakira, the singer. The lyrics express surprise at her skilled dancing, which captivates the audience and makes them want to speak Spanish. The repetition of Spanish phrases like Como se llama and Bonita further emphasizes the Hispanic cultural references."
        //     },
        //     "3": {
        //       "text": "♪ Oh, baby, when you talk like that ♪\n♪ You make a woman go mad ♪\n♪ So be wise, si ♪\n♪ And keep on, si ♪\n♪ Reading the signs of my body ♪",
        //       "meaning": "This paragraph shifts the focus to the effect Shakira's dancing and singing have on the audience, particularly the men. The lyrics suggest that her seductive manner and confidence make the listeners, especially the women, lose control. The advice to be wise and keep on reading the signs implies a playful, flirtatious interaction between Shakira and her audience."
        //     },
        //     "4": {
        //       "text": "♪ I'm on tonight ♪\n♪ You know my hips don't lie ♪\n♪ And I'm starting to feel it's right ♪\n♪ All the attraction, the tension ♪\n♪ Don't you see, baby,\nthis is perfection ♪",
        //       "meaning": "This paragraph further emphasizes Shakira's self-assurance and the captivating effect she has on her audience. The lyrics highlight her hips, which don't lie, and the growing sense of attraction and tension between her and the listeners. The overall message is one of confidence and the acknowledgment of a perfect, sensual connection."
        //     },
        //     "5": {
        //       "text": "♪ Hey, girl, I can see your body moving ♪\n♪ And it's driving me crazy ♪\n♪ And I didn't have the slightest idea ♪\n♪ Until I saw you dancing ♪\n♪ And when you walk up\non the dance floor ♪\n♪ Nobody cannot ignore the\nway you move your body, girl ♪",
        //       "meaning": "This paragraph shifts the perspective to one of the male audience members, who is mesmerized by Shakira's captivating dance moves. The lyrics express his surprise and growing desire, as he becomes increasingly entranced by her performance on the dance floor."
        //     },
        //     "6": {
        //       "text": "♪ And everything so unexpected ♪\n♪ The way you right and left it ♪\n♪ So you can keep on shaking it ♪",
        //       "meaning": "This short paragraph continues the male audience member's perspective, expressing his awe and excitement at Shakira's unexpected and skillful dance moves. The lyrics encourage her to keep shaking it, indicating his enthusiastic approval and desire for her to continue performing."
        //     },
        //     "7": {
        //       "text": "♪ Baila en la calle de noche ♪\n♪ Baila en la calle de dia ♪\n♪ Baila en la calle de noche ♪\n♪ Baila en la calle de dia ♪",
        //       "meaning": "This paragraph shifts the focus back to Shakira, encouraging her to dance both at night and during the day, on the streets. The repetition of Baila en la calle (Dance on the street) emphasizes her freedom and confidence in performing her dance moves publicly, without restriction."
        //     },
        //     "8": {
        //       "text": "♪ Senorita, feel the conga ♪\n♪ Let me see you move like\nyou come from Colombia ♪\n♪ Ladies, si ♪\n♪ Mira en Barranquilla\nse baila asi, say it ♪\n♪ En Barranquilla se baila asi ♪",
        //       "meaning": "This paragraph reinforces the Latin American, specifically Colombian, cultural references in the song. The lyrics encourage the audience, particularly the women, to dance to the conga rhythm and move like they are from Colombia. The mention of the city of Barranquilla emphasizes the regional cultural influence on Shakira's performance."
        //     },
        //     "9": {
        //       "text": "♪ Yeah, she's so sexy,\nevery man's fantasy ♪\n♪ A refugee like me back with the Fugees ♪\n♪ From a third world country ♪\n♪ I go back like when Pac\ncarried crates for Humpty Humpty ♪\n♪ We leave the whole club dizzy ♪\n♪ Why the CIA wanna watch us ♪\n♪ Colombians and Haitians ♪\n♪ I ain't guilty, it's\na musical transaction ♪\n♪ Bo bop so bop, no more\ndo we snatch ropes ♪\n♪ Refugees run the seas\ncause we own our own boats ♪",
        //       "meaning": "This final paragraph delves deeper into the cultural and political references in the song. It describes Shakira as a sexy, captivating figure, a fantasy for all men. It also connects her to her background as a refugee from a third-world country, specifically mentioning the Fugees, a hip-hop group with roots in Colombia and Haiti. The lyrics touch on issues of law enforcement surveillance, the musical nature of their performance, and the resilience of refugees. Overall, this paragraph adds depth and context to the song's celebration of Shakira's artistry and cultural identity."
        //   }
        //   }
        
        // Display transcript with click handlers
        displayTranscript(analysis);
        
        // Clear initial analysis display
        const analysisContent = document.getElementById('analysisContent');
        if (analysisContent) {
            analysisContent.innerHTML = '<p>Click on a paragraph in the transcript to see its analysis.</p>';
        }
    } else {
        alert('Invalid YouTube URL');
    }
});




    </script>
</body>
</html>